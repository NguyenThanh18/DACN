
@{
    ViewBag.Title = "SuaBaiViet";
    var listTP = ViewBag.TP;
    var listQuan = ViewBag.Quan;
    var listPhuong = ViewBag.Phuong;
    var listLoaiBDS = ViewBag.LoaiBDS;
    var res = ViewBag.Detail;
}
@using DACN.Models.EF
@model BaiViet
<style>

    .dropzone {
        width: 300px;
        height: 200px;
        border: 1px dashed #999;
        border-radius: 3px;
        text-align: center;
        justify-content: center;
    }

    .upload-icon {
        margin: 80px 2px 2px 2px;
    }

    .upload-input {
        position: relative;
        top: -62px;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
    }
</style>
<div style="margin-left: 100px; margin: 50px">
    @using (Html.BeginForm("SuaBaiViet", "Posts", FormMethod.Post))
    {
        // @Html.AntiForgeryToken()
        @Html.ValidationSummary(false, "", new { @class = "text-danger" });
        foreach (var item in res)
        {
            <input type="text" value="@item.idBV" style="display: none"/>
            <div class="row" style="margin-bottom: 30px">
                <div class="col-md-12">
                    <h2>Địa chỉ cho thuê</h2>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="col-form-label" for="district_id">Tỉnh/Thành phố</label>
                        <select name="TenTP" class="form-control" required="" aria-hidden="true">
                            <option value="0">-- Chọn Tỉnh/TP --</option>
                            @foreach (var item1 in listTP)
                            {
                                <option value="@item1.Alias">@item1.TenTP</option>
                            }
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="col-form-label" for="district_id">Quận/Huyện</label>
                        <select name="TenQuan" class="form-control" required="" aria-hidden="true">
                            <option value="0">-- Quận/huyện -- </option>
                            @foreach (var item2 in listQuan)
                            {
                                <option value="@item2.idQuan">@item2.TenQuan</option>
                            }
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label class="col-form-label" for="phuongxa">Phường/Xã</label>
                        <select class="form-control" name="TenPhuong" aria-hidden="true">
                            <option value="0">-- Phường/Xã --</option>
                            @foreach (var item3 in listPhuong)
                            {
                                <option value="@item3.idPhuong">@item3.TenPhuong</option>
                            }
                        </select>
                    </div>
                </div>

            </div>
            <div class="row">
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="street_number" class="col-form-label">Số nhà</label>
                        <input type="text" class="form-control" name="SoNha" value="">
                    </div>
                </div>
            </div>
            <div class="form-group row mt-5">
                <div class="col-md-12">
                    <h3>Thông tin mô tả</h3>
                </div>
            </div>
            <div class="form-group row mt-3">
                <label for="post_cat" class="col-md-12 col-form-label">Loại chuyên mục</label>
                <div class="col-md-3">
                    <select class="form-control" name="TenLoai" required="">
                        <option value="0">-- Chọn loại chuyên mục --</option>
                        @foreach (var item4 in listLoaiBDS)
                        {
                            <option value="@item4.idBDS">@item4.TenLoai</option>
                        }
                    </select>
                </div>
            </div>
            <div class="form-group row">
                <label for="post_title" class="col-md-12 col-form-label">Tiêu đề</label>
                <div class="col-md-9">
                    <input type="text" class="form-control" name="TieuDe" value="@item.tieude" minlength="30" maxlength="120" required="">
                </div>
            </div>
            <div class="form-group row">
                <label for="post_title" class="col-md-12 col-form-label">Tiêu đề phụ</label>
                <div class="col-md-9">
                    <input type="text" class="form-control" name="TieuDePhu" value="@item.tieudephu" minlength="30" maxlength="120" required="">
                </div>
            </div>
            <div class="form-group row">
                <label for="post_content" class="col-md-12 col-form-label">Nội dung mô tả</label>
                <div class="col-md-9">
                    @Html.TextAreaFor(Model => Model.MoTa, new { @class = "form-control", rows = "3"})
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-4">
                    <div class="form-group row">
                        <label for="giachothue" class="col-md-12 col-form-label">Giá cho thuê</label>
                        <div class="col-md-6">
                            <div class="input-group mb-3">
                                <input name="Gia" pattern="[0-9.]+" type="text" value="@item.gia" class="form-control" required="" placeholder="Đồng">
                                <div class="input-group-append">
                                    @*<span class="input-group-text">đồng</span>*@
                                </div>
                            </div>
                            <small class="form-text text-muted">Nhập đầy đủ số, ví dụ 1 triệu thì nhập là 1000000</small>
                        </div>
                        <label for="text_giachothue" class="col-sm-12 control-label" style="color: red;"></label>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="col-form-label" for="district_id">Phòng ngủ</label>
                                <input type="number" class="form-control" name="PhongNgu" value="@item.phongngu"/>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="col-form-label" for="district_id">Lầu</label>
                                <input type="number" class="form-control" name="Lau" value="@item.lau"/>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="col-form-label" for="district_id">Nhà tắm</label>
                                <input type="number" class="form-control" name="NhaTam" value="@item.nhatam"/>
                            </div>
                        </div>

                    </div>
                    <div class="form-group row">
                        <label for="post_acreage" class="col-md-9 col-form-label">Diện tích</label>
                        <div class="col-md-6">
                            <div class="input-group mb-3">
                                <input type="number" attern="[0-9.]+" value="@item.dientich" name="DienTich" max="1000" class="form-control" required="" placeholder="m2">
                                <div class="input-group-append">
                                    @*<span class="input-group-text">m<sup>2</sup></span>*@
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <label for="uploadImage" class="col-md-12 col-form-label">Tải ảnh lên</label>
                    <div class="dropzone" style="margin-top: 20px;" id="formUpload">
                        <img src="~/Content/Images/upload.svg" class="upload-icon" id="pictureUpload" />
                        <input type="file" class="upload-input" id="fileUpload" name="ImageUpload" accept="image/*" onchange="ShowImagePreview(this, document.getElementById('previewImage'), document.getElementById('formUpload'))" />

                    </div>
                    <img class="upload-icon" id="previewImage" style="width: 300px; margin-top: -5px" />
                </div>
            </div>

            <input type="submit" value="Đăng bài" id="btnUploadPost" class="btn btn-success" />
            }
        }
</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
@section upload
{
    <script>
        $(function () {
            //Đăng ký sự kiện click nút btnUpload
            //Bắt sự kiện change data của fileUpload
            $('#btnUploadPost').click(function () {
                if (window.FormData !== undefined) {
                    var fileUpload = $('#fileUpload').get(0);
                    var files = fileUpload.files;

                    var formData = new FormData();
                    formData.append('file', files[0]);
                    $.ajax(
                        {
                            type: 'POST',
                            url: '/Posting/ProcessUpload',
                            contentType: false,
                            processData: false,
                            data: formData,
                            success: function (urlImage) {
                                $('#pictureUpload').attr('src', urlImage);
                            },
                            error: function (err) {
                                alert('Có lỗi khi upload: ' + err.statusText);
                            }
                        });
                }
            });
        });
    </script>
}


